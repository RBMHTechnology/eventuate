

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Event log &mdash; Eventuate</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Eventuate" href="../index.html"/>
        <link rel="up" title="Reference" href="../reference.html"/>
        <link rel="next" title="Event-sourced actors" href="event-sourcing.html"/>
        <link rel="prev" title="API docs" href="api-docs.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

  
	<script src="//fonts.redbullmediahouse.com/snv5vzo.js"></script>
	<script>try{Typekit.load();}catch(e){}</script>
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          
          <a href="../index.html"><img src="../_static/RedBullMediaHouse-dark.png" class="logo" /></a>
        
        
		
<div role="search" class="searchbox">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search Eventuate" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
	
        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting-started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../architecture.html">Architecture</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../architecture.html#event-logs">Event logs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../architecture.html#event-sourcing">Event sourcing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../architecture.html#operation-based-crdts">Operation-based CRDTs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../architecture.html#vector-clocks">Vector clocks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../architecture.html#batching">Batching</a></li>
<li class="toctree-l2"><a class="reference internal" href="../architecture.html#adapters">Adapters</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../user-guide.html">User guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../user-guide.html#event-sourced-actors">Event-sourced actors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user-guide.html#detecting-concurrent-updates">Detecting concurrent updates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user-guide.html#tracking-conflicting-versions">Tracking conflicting versions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user-guide.html#resolving-conflicting-versions">Resolving conflicting versions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user-guide.html#operation-based-crdts">Operation-based CRDTs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user-guide.html#event-sourced-views">Event-sourced views</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user-guide.html#conditional-requests">Conditional requests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user-guide.html#event-collaboration">Event collaboration</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../reference.html">Reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="api-docs.html">API docs</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Event log</a></li>
<li class="toctree-l2"><a class="reference internal" href="event-sourcing.html">Event-sourced actors</a></li>
<li class="toctree-l2"><a class="reference internal" href="event-sourcing.html#event-sourced-views">Event-sourced views</a></li>
<li class="toctree-l2"><a class="reference internal" href="event-sourcing.html#event-sourced-writers">Event-sourced writers</a></li>
<li class="toctree-l2"><a class="reference internal" href="event-sourcing.html#event-sourced-processors">Event-sourced processors</a></li>
<li class="toctree-l2"><a class="reference internal" href="event-sourcing.html#state-recovery">State recovery</a></li>
<li class="toctree-l2"><a class="reference internal" href="event-sourcing.html#snapshots">Snapshots</a></li>
<li class="toctree-l2"><a class="reference internal" href="event-sourcing.html#event-routing">Event routing</a></li>
<li class="toctree-l2"><a class="reference internal" href="event-sourcing.html#reliable-delivery">Reliable delivery</a></li>
<li class="toctree-l2"><a class="reference internal" href="event-sourcing.html#event-collaboration">Event collaboration</a></li>
<li class="toctree-l2"><a class="reference internal" href="event-sourcing.html#conditional-requests">Conditional requests</a></li>
<li class="toctree-l2"><a class="reference internal" href="event-sourcing.html#command-stashing">Command stashing</a></li>
<li class="toctree-l2"><a class="reference internal" href="event-sourcing.html#failure-handling">Failure handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="event-sourcing.html#custom-serialization">Custom serialization</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuration.html">Configuration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../resources.html">Resources</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../resources.html#articles">Articles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../resources.html#presentations">Presentations</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../download.html">Download</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../download.html#binaries">Binaries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../download.html#sources">Sources</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../developers.html">Developers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../developers.html#contributing-to-eventuate">Contributing to Eventuate</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developers.html#building-eventuate">Building Eventuate</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../project.html">Project</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../project.html#community">Community</a></li>
<li class="toctree-l2"><a class="reference internal" href="../project.html#license">License</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQ</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../faq.html#how-does-eventuate-compare-to-akka-persistence">How does Eventuate compare to Akka Persistence?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../example-application.html">Example application</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../example-application.html#domain">Domain</a></li>
<li class="toctree-l2"><a class="reference internal" href="../example-application.html#replication">Replication</a></li>
<li class="toctree-l2"><a class="reference internal" href="../example-application.html#interface">Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../example-application.html#running">Running</a></li>
<li class="toctree-l2"><a class="reference internal" href="../example-application.html#disaster-recovery">Disaster recovery</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../current-limitations.html">Current limitations</a></li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html"><img src="../_static/RedBullMediaHouse-light.png" class="logo" /></a>
      </nav>
 
      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li>
		<a href="../index.html"><h2><span class="breadcrumbicon rbicons topfront"><i class="fa fa-calendar"></i></span>Eventuate</h2></a> &raquo;
	</li>
    
    <li><a href="../reference.html">Reference</a> &raquo;</li>
    
    <li>Event log</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="event-log">
<span id="id1"></span><h1>Event log<a class="headerlink" href="#event-log" title="Permalink to this headline">¶</a></h1>
<div class="section" id="local-event-log">
<span id="id2"></span><h2>Local event log<a class="headerlink" href="#local-event-log" title="Permalink to this headline">¶</a></h2>
<p>A local event log belongs to a given <em>location</em><a class="footnote-reference" href="#id13" id="id3">[1]</a> and a location can have one or more local event logs. Depending on the storage backend, a local event log may optionally be replicated within that location for stronger durability guarantees but this is rather an implementation details of the local event log. From Eventuate’s perspective, event replication occurs between different locations which is further described in section <a class="reference internal" href="#replicated-event-log"><span>Replicated event log</span></a>.</p>
<p>To an application, an event log is represented by an event log actor. Producers and consumers interact with that actor to write events to and read events from the event log. They also register at the event log actor to be notified about newly written events. The messages that can be exchanged with an event log actor are defined in <a class="reference external" href="../latest/api/index.html#com.rbmhtechnology.eventuate.EventsourcingProtocol$">EventsourcingProtocol</a> and <a class="reference external" href="../latest/api/index.html#com.rbmhtechnology.eventuate.ReplicationProtocol$">ReplicationProtocol</a>.</p>
<p>At the moment, two storage backends are directly supported by Eventuate, <a class="reference external" href="https://github.com/google/leveldb">LevelDB</a> and <a class="reference external" href="http://cassandra.apache.org/">Cassandra</a>. Usage of the corresponding event log actors is explained in <a class="reference internal" href="#leveldb-storage-backend"><span>LevelDB storage backend</span></a> and <a class="reference internal" href="#cassandra-storage-backend"><span>Cassandra storage backend</span></a>, respectively. The integration of custom storage backends into Eventuate is explained in <a class="reference internal" href="#custom-storage-backends"><span>Custom storage backends</span></a>.</p>
<div class="section" id="leveldb-storage-backend">
<span id="id4"></span><h3>LevelDB storage backend<a class="headerlink" href="#leveldb-storage-backend" title="Permalink to this headline">¶</a></h3>
<p>A local event log actor with a LevelDB storage backend writes events to the local file system. It can be created with:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">import</span> <span class="nn">akka.actor.ActorSystem</span>
<span class="k">import</span> <span class="nn">com.rbmhtechnology.eventuate.log.leveldb.LeveldbEventLog</span>

<span class="k">val</span> <span class="n">system</span><span class="k">:</span> <span class="kt">ActorSystem</span> <span class="o">=</span> <span class="c1">// ...</span>
<span class="k">val</span> <span class="n">log</span> <span class="k">=</span> <span class="n">system</span><span class="o">.</span><span class="n">actorOf</span><span class="o">(</span><span class="nc">LeveldbEventLog</span><span class="o">.</span><span class="n">props</span><span class="o">(</span><span class="n">logId</span> <span class="k">=</span> <span class="s">&quot;L1&quot;</span><span class="o">,</span> <span class="n">prefix</span> <span class="k">=</span> <span class="s">&quot;log&quot;</span><span class="o">))</span>
</pre></div>
</div>
<p>Applications must provide a unique <code class="docutils literal"><span class="pre">logId</span></code> for that log, the <code class="docutils literal"><span class="pre">prefix</span></code> is optional and defaults to <code class="docutils literal"><span class="pre">log</span></code>. This will create a directory <code class="docutils literal"><span class="pre">log-L1</span></code> in which the LevelDB files are stored. The root directory of all local LevelDB directories can be configured with the <code class="docutils literal"><span class="pre">eventuate.log.leveldb.dir</span></code> configuration key in <code class="docutils literal"><span class="pre">application.conf</span></code>:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="n">eventuate</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">leveldb</span><span class="o">.</span><span class="n">dir</span> <span class="k">=</span> <span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">eventuate</span>
</pre></div>
</div>
<p>With this configuration, the absolute path of the LevelDB directory in the above example is <code class="docutils literal"><span class="pre">/var/eventuate/log-L1</span></code>. If not configured, <code class="docutils literal"><span class="pre">eventuate.log.leveldb.dir</span></code> defaults to <code class="docutils literal"><span class="pre">target</span></code>. Further <code class="docutils literal"><span class="pre">eventuate.log.leveldb</span></code> configuration options are given in section <a class="reference internal" href="configuration.html#configuration"><span>Configuration</span></a>.</p>
</div>
<div class="section" id="cassandra-storage-backend">
<span id="id5"></span><h3>Cassandra storage backend<a class="headerlink" href="#cassandra-storage-backend" title="Permalink to this headline">¶</a></h3>
<p>Eventuate also provides an event log actor implementation that writes events to a Cassandra cluster. That actor can be created with:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">import</span> <span class="nn">akka.actor.ActorSystem</span>
<span class="k">import</span> <span class="nn">com.rbmhtechnology.eventuate.log.cassandra.CassandraEventLog</span>

<span class="k">val</span> <span class="n">system</span><span class="k">:</span> <span class="kt">ActorSystem</span> <span class="o">=</span> <span class="c1">// ...</span>
<span class="k">val</span> <span class="n">log</span> <span class="k">=</span> <span class="n">system</span><span class="o">.</span><span class="n">actorOf</span><span class="o">(</span><span class="nc">CassandraEventLog</span><span class="o">.</span><span class="n">props</span><span class="o">(</span><span class="n">logId</span> <span class="k">=</span> <span class="s">&quot;L1&quot;</span><span class="o">))</span>
</pre></div>
</div>
<p>With default configuration settings the event log actor connects to a Cassandra node at <code class="docutils literal"><span class="pre">127.0.0.1:9042</span></code>. This can be customized with</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="n">eventuate</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">cassandra</span><span class="o">.</span><span class="n">contact</span><span class="o">-</span><span class="n">points</span> <span class="k">=</span> <span class="o">[</span><span class="kt">host1</span><span class="o">[</span><span class="kt">:port1</span><span class="o">]</span>, <span class="kt">host2</span><span class="o">[</span><span class="kt">:port2</span><span class="o">]</span>, <span class="kt">...</span><span class="o">]</span>
</pre></div>
</div>
<p>Ports are optional and default to <code class="docutils literal"><span class="pre">9042</span></code> according to</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="n">eventuate</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">cassandra</span><span class="o">.</span><span class="n">default</span><span class="o">-</span><span class="n">port</span> <span class="k">=</span> <span class="mi">9042</span>
</pre></div>
</div>
<p>If Cassandra requires authentication, the default username used by Eventuate is <code class="docutils literal"><span class="pre">cassandra</span></code>, the default password is <code class="docutils literal"><span class="pre">cassandra</span></code> (which corresponds to Cassandra&#8217;s default superuser). This can be changed with</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="n">eventuate</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">cassandra</span><span class="o">.</span><span class="n">username</span> <span class="k">=</span> <span class="s">&quot;my-username&quot;</span>
<span class="n">eventuate</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">cassandra</span><span class="o">.</span><span class="n">password</span> <span class="k">=</span> <span class="s">&quot;my-password&quot;</span>
</pre></div>
</div>
<p>Further details are described in the API docs of the <a class="reference external" href="../latest/api/index.html#com.rbmhtechnology.eventuate.log.cassandra.Cassandra">Cassandra extension</a> and the <a class="reference external" href="../latest/api/index.html#com.rbmhtechnology.eventuate.log.cassandra.CassandraEventLog">CassandraEventLog</a> actor. A complete reference of <code class="docutils literal"><span class="pre">eventuate.log.cassandra</span></code> configuration options is given in section <a class="reference internal" href="configuration.html#configuration"><span>Configuration</span></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Eventuate requires Cassandra version 2.1 or higher.</p>
</div>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">For instructions how to run a local Cassandra cluster you may want to read the article <a class="reference external" href="http://rbmhtechnology.github.io/chaos-testing-with-docker-and-cassandra/">Chaos testing with Docker and Cassandra on Mac OS X</a>.</p>
</div>
</div>
<div class="section" id="custom-storage-backends">
<span id="id6"></span><h3>Custom storage backends<a class="headerlink" href="#custom-storage-backends" title="Permalink to this headline">¶</a></h3>
<p>A custom storage backend can be integrated into Eventuate by extending the abstract <a class="reference external" href="../latest/api/index.html#com.rbmhtechnology.eventuate.log.EventLog">EventLog</a> actor and implementing the <a class="reference external" href="../latest/api/index.html#com.rbmhtechnology.eventuate.log.EventLogSPI">EventLogSPI</a> trait. For implementation examples, please take a look at <a class="reference external" href="https://github.com/RBMHTechnology/eventuate/tree/master/src/main/scala/com/rbmhtechnology/eventuate/log/leveldb/LeveldbEventLog.scala">LeveldbEventLog.scala</a> and <a class="reference external" href="https://github.com/RBMHTechnology/eventuate/tree/master/src/main/scala/com/rbmhtechnology/eventuate/log/cassandra/CassandraEventLog.scala">CassandraEventLog.scala</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The event log storage provider interface (<code class="docutils literal"><span class="pre">EventLogSPI</span></code>) is preliminary and likely to be changed in future versions.</p>
</div>
</div>
</div>
<div class="section" id="replicated-event-log">
<span id="id7"></span><h2>Replicated event log<a class="headerlink" href="#replicated-event-log" title="Permalink to this headline">¶</a></h2>
<p>Local event logs from different locations can be connected for event replication. For example, when connecting a local event log <code class="docutils literal"><span class="pre">L1</span></code> at location <code class="docutils literal"><span class="pre">1</span></code> with a local event log <code class="docutils literal"><span class="pre">L2</span></code> at location <code class="docutils literal"><span class="pre">2</span></code>, then the events written to <code class="docutils literal"><span class="pre">L1</span></code> are asynchronously replicated to location <code class="docutils literal"><span class="pre">2</span></code> and merged into to <code class="docutils literal"><span class="pre">L2</span></code>. Also, events written to <code class="docutils literal"><span class="pre">L2</span></code> are asynchronously replicated to location <code class="docutils literal"><span class="pre">1</span></code> and merged into <code class="docutils literal"><span class="pre">L1</span></code>. Merging preserves the causal ordering of events which is tracked with <a class="reference internal" href="../architecture.html#vector-clocks"><span>Vector clocks</span></a>. Setting up a bi-directional replication connection between local event logs <code class="docutils literal"><span class="pre">L1</span></code> and <code class="docutils literal"><span class="pre">L2</span></code> yields a <em>replicated event log</em> <code class="docutils literal"><span class="pre">L</span></code>:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="n">L1</span> <span class="o">----</span> <span class="n">L2</span>
</pre></div>
</div>
<p>Since events can be written concurrently at different locations, the total order of events in the local event logs at different locations is likely to differ. The causal order of events, however, is consistent across locations: if event <code class="docutils literal"><span class="pre">e1</span></code> causes event <code class="docutils literal"><span class="pre">e2</span></code> (i.e. <code class="docutils literal"><span class="pre">e1</span></code> happened before <code class="docutils literal"><span class="pre">e2</span></code>) then the offset of <code class="docutils literal"><span class="pre">e1</span></code> is less than the offset of <code class="docutils literal"><span class="pre">e2</span></code> at all locations. The offset of an event in a local event log is its local sequence number. On the other hand, if <code class="docutils literal"><span class="pre">e1</span></code> and <code class="docutils literal"><span class="pre">e2</span></code> are written concurrently, their relative order in a local event log is not defined: the offset of <code class="docutils literal"><span class="pre">e1</span></code> can be less than that of <code class="docutils literal"><span class="pre">e2</span></code> at one location but greater than that of <code class="docutils literal"><span class="pre">e2</span></code> at another location.</p>
<p>A replicated event log can also be set up for more than two locations. Here event log <code class="docutils literal"><span class="pre">L</span></code> is replicated across locations <code class="docutils literal"><span class="pre">1</span></code> - <code class="docutils literal"><span class="pre">6</span></code>:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="n">L1</span>           <span class="n">L5</span>
  <span class="o">\</span>         <span class="o">/</span>
   <span class="n">L2</span> <span class="o">---</span> <span class="n">L4</span>
  <span class="o">/</span>         <span class="o">\</span>
<span class="n">L3</span>           <span class="n">L6</span>
</pre></div>
</div>
<p>A location may also have several local event logs that can be replicated independently of each other. The following example shows three replicated events logs <code class="docutils literal"><span class="pre">L</span></code>, <code class="docutils literal"><span class="pre">M</span></code> and <code class="docutils literal"><span class="pre">N</span></code> that are replicated across locations <code class="docutils literal"><span class="pre">1</span></code> and <code class="docutils literal"><span class="pre">2</span></code>:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="n">L1</span> <span class="o">----</span> <span class="n">L2</span>
<span class="n">M1</span> <span class="o">----</span> <span class="n">M2</span>
<span class="n">N1</span> <span class="o">----</span> <span class="n">N2</span>
</pre></div>
</div>
<p>The distribution of <code class="docutils literal"><span class="pre">L</span></code>, <code class="docutils literal"><span class="pre">M</span></code> and <code class="docutils literal"><span class="pre">N</span></code> across locations may also differ:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="n">L1</span> <span class="o">----</span> <span class="n">L2</span>
<span class="n">M1</span> <span class="o">----</span> <span class="n">M2</span> <span class="o">---</span> <span class="n">M3</span>
        <span class="n">N2</span> <span class="o">---</span> <span class="n">N3</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Event replication is reliable and can recover from network failures. It can also recover from crashes of source and target locations i.e. event replication automatically resumes when a crashed location recovers. Replicated events are also guaranteed to be written <em>exactly-once</em> to a target log. This is possible because replication progress metadata are stored along with replicated events in the target log. This allows a replication target to reliably detect and ignore duplicates. Event-sourced actors, views, writers and processors can therefore rely on receiving a de-duplicated event stream.</p>
</div>
<div class="section" id="replication-endpoints">
<span id="id8"></span><h3>Replication endpoints<a class="headerlink" href="#replication-endpoints" title="Permalink to this headline">¶</a></h3>
<p>Events are replicated over <em>replication connections</em> that are established between <em>replication endpoints</em>. A location may have one or more replication endpoints and a replication endpoint can manage one or more event logs. The following examples assume two locations <code class="docutils literal"><span class="pre">1</span></code> and <code class="docutils literal"><span class="pre">2</span></code> and two replicated event logs <code class="docutils literal"><span class="pre">L</span></code> and <code class="docutils literal"><span class="pre">M</span></code>:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="n">L1</span> <span class="o">----</span> <span class="n">L2</span>
<span class="n">M1</span> <span class="o">----</span> <span class="n">M2</span>
</pre></div>
</div>
<p>Each location has a <code class="docutils literal"><span class="pre">ReplicationEndpoint</span></code> that manages the local event logs. Replication endpoints communicate with each other via <a class="reference external" href="http://doc.akka.io/docs/akka/2.4.1/scala/remoting.html">Akka Remoting</a> which must be enabled by all locations in their <code class="docutils literal"><span class="pre">application.conf</span></code>:</p>
<div class="highlight-scala"><div class="highlight"><pre>akka.actor.provider = &quot;akka.remote.RemoteActorRefProvider&quot;
akka.remote.enabled-transports = [&quot;akka.remote.netty.tcp&quot;]
</pre></div>
</div>
<p>The network address of the replication endpoint at location <code class="docutils literal"><span class="pre">1</span></code> is:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="n">akka</span><span class="o">.</span><span class="n">remote</span><span class="o">.</span><span class="n">netty</span><span class="o">.</span><span class="n">tcp</span><span class="o">.</span><span class="n">hostname</span> <span class="k">=</span> <span class="s">&quot;127.0.0.1&quot;</span>
<span class="n">akka</span><span class="o">.</span><span class="n">remote</span><span class="o">.</span><span class="n">netty</span><span class="o">.</span><span class="n">tcp</span><span class="o">.</span><span class="n">port</span><span class="k">=</span><span class="mi">2552</span>
</pre></div>
</div>
<p>At location <code class="docutils literal"><span class="pre">2</span></code> it is:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="n">akka</span><span class="o">.</span><span class="n">remote</span><span class="o">.</span><span class="n">netty</span><span class="o">.</span><span class="n">tcp</span><span class="o">.</span><span class="n">hostname</span> <span class="k">=</span> <span class="s">&quot;127.0.0.1&quot;</span>
<span class="n">akka</span><span class="o">.</span><span class="n">remote</span><span class="o">.</span><span class="n">netty</span><span class="o">.</span><span class="n">tcp</span><span class="o">.</span><span class="n">port</span><span class="k">=</span><span class="mi">2553</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">ReplicationEndpoint</span></code> at location <code class="docutils literal"><span class="pre">1</span></code> can be created programmatically with:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">import</span> <span class="nn">com.rbmhtechnology.eventuate._</span>
<span class="k">import</span> <span class="nn">com.rbmhtechnology.eventuate.log.leveldb.LeveldbEventLog</span>

<span class="k">implicit</span> <span class="k">val</span> <span class="n">system</span><span class="k">:</span> <span class="kt">ActorSystem</span> <span class="o">=</span>
  <span class="nc">ActorSystem</span><span class="o">(</span><span class="nc">ReplicationConnection</span><span class="o">.</span><span class="nc">DefaultRemoteSystemName</span><span class="o">)</span>

<span class="k">val</span> <span class="n">endpoint1</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ReplicationEndpoint</span><span class="o">(</span><span class="n">id</span> <span class="k">=</span> <span class="s">&quot;1&quot;</span><span class="o">,</span> <span class="n">logNames</span> <span class="k">=</span> <span class="nc">Set</span><span class="o">(</span><span class="s">&quot;L&quot;</span><span class="o">,</span> <span class="s">&quot;M&quot;</span><span class="o">),</span>
  <span class="n">logFactory</span> <span class="k">=</span> <span class="n">logId</span> <span class="k">=&gt;</span> <span class="nc">LeveldbEventLog</span><span class="o">.</span><span class="n">props</span><span class="o">(</span><span class="n">logId</span><span class="o">),</span>
  <span class="n">connections</span> <span class="k">=</span> <span class="nc">Set</span><span class="o">(</span><span class="nc">ReplicationConnection</span><span class="o">(</span><span class="s">&quot;127.0.0.1&quot;</span><span class="o">,</span> <span class="mi">2553</span><span class="o">)))</span>

<span class="n">endpoint1</span><span class="o">.</span><span class="n">activate</span><span class="o">()</span>
</pre></div>
</div>
<p>A <code class="docutils literal"><span class="pre">ReplicationEndpoint</span></code> must have a global unique <code class="docutils literal"><span class="pre">id</span></code>. Here, the location identifier <code class="docutils literal"><span class="pre">1</span></code> is used to identify the replication endpoint. Furthermore, the <code class="docutils literal"><span class="pre">logNames</span></code><a class="footnote-reference" href="#id14" id="id9">[2]</a> of the replicated event logs (<code class="docutils literal"><span class="pre">L</span></code> and <code class="docutils literal"><span class="pre">M</span></code>) and a <code class="docutils literal"><span class="pre">logFactory</span></code> for creating the local event log actors are passed as constructor arguments. Input parameter of the <code class="docutils literal"><span class="pre">logFactory</span></code> is a unique <code class="docutils literal"><span class="pre">logId</span></code> that is generated by the replication endpoint from a combination of the given <code class="docutils literal"><span class="pre">logNames</span></code> and the endpoint <code class="docutils literal"><span class="pre">id</span></code>.</p>
<p>The last <code class="docutils literal"><span class="pre">ReplicationEndpoint</span></code> constructor parameter is a set of <code class="docutils literal"><span class="pre">ReplicationConnection</span></code>s. Here, it is a single replication connection that connects to the remote replication endpoint at location <code class="docutils literal"><span class="pre">2</span></code>. With this replication connection, events are replicated from location <code class="docutils literal"><span class="pre">2</span></code> to location <code class="docutils literal"><span class="pre">1</span></code>. For starting event replication, a replication endpoint must be activated by calling the <code class="docutils literal"><span class="pre">activate()</span></code> method. For replicating events in the other direction, a corresponding <code class="docutils literal"><span class="pre">ReplicationEndpoint</span></code> and <code class="docutils literal"><span class="pre">ReplicationConnection</span></code> must be set up at location <code class="docutils literal"><span class="pre">2</span></code>:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">val</span> <span class="n">endpoint2</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ReplicationEndpoint</span><span class="o">(</span><span class="n">id</span> <span class="k">=</span> <span class="s">&quot;2&quot;</span><span class="o">,</span> <span class="n">logNames</span> <span class="k">=</span> <span class="nc">Set</span><span class="o">(</span><span class="s">&quot;L&quot;</span><span class="o">,</span> <span class="s">&quot;M&quot;</span><span class="o">),</span>
  <span class="n">logFactory</span> <span class="k">=</span> <span class="n">logId</span> <span class="k">=&gt;</span> <span class="nc">LeveldbEventLog</span><span class="o">.</span><span class="n">props</span><span class="o">(</span><span class="n">logId</span><span class="o">),</span>
  <span class="n">connections</span> <span class="k">=</span> <span class="nc">Set</span><span class="o">(</span><span class="nc">ReplicationConnection</span><span class="o">(</span><span class="s">&quot;127.0.0.1&quot;</span><span class="o">,</span> <span class="mi">2552</span><span class="o">)))</span>

<span class="n">endpoint2</span><span class="o">.</span><span class="n">activate</span><span class="o">()</span>
</pre></div>
</div>
<p>The event log actors that are created by a <code class="docutils literal"><span class="pre">ReplicationEndpoint</span></code> can be obtained from its <code class="docutils literal"><span class="pre">logs</span></code> map. Map keys are the event log names, map values the event log <code class="docutils literal"><span class="pre">ActorRef</span></code>s:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">val</span> <span class="n">l1</span><span class="k">:</span> <span class="kt">ActorRef</span> <span class="o">=</span> <span class="n">endpoint1</span><span class="o">.</span><span class="n">logs</span><span class="o">(</span><span class="s">&quot;L&quot;</span><span class="o">)</span>
<span class="k">val</span> <span class="n">m1</span><span class="k">:</span> <span class="kt">ActorRef</span> <span class="o">=</span> <span class="n">endpoint1</span><span class="o">.</span><span class="n">logs</span><span class="o">(</span><span class="s">&quot;M&quot;</span><span class="o">)</span>
</pre></div>
</div>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">Further <code class="docutils literal"><span class="pre">ReplicationEndpoint</span></code> creation options are described in the API documentation of the <a class="reference external" href="../latest/api/index.html#com.rbmhtechnology.eventuate.ReplicationEndpoint$">ReplicationEndpoint</a> and <a class="reference external" href="../latest/api/index.html#com.rbmhtechnology.eventuate.ReplicationConnection$">ReplicationConnection</a> companion objects. A complete reference of configuration options is given in section <a class="reference internal" href="configuration.html#configuration"><span>Configuration</span></a>.</p>
</div>
</div>
<div class="section" id="replication-filters">
<span id="id10"></span><h3>Replication filters<a class="headerlink" href="#replication-filters" title="Permalink to this headline">¶</a></h3>
<p>By default, all events are replicated. Applications may provide <code class="docutils literal"><span class="pre">ReplicationFilter</span></code>s to limit replication to a subset of events. A custom replication filter can be defined, by extending <a class="reference external" href="../latest/api/index.html#com.rbmhtechnology.eventuate.ReplicationFilter">ReplicationFilter</a> and implementing a filter predicate (method <code class="docutils literal"><span class="pre">apply</span></code>). For example, the following replication filter selects <a class="reference external" href="../latest/api/index.html#com.rbmhtechnology.eventuate.DurableEvent">DurableEvent</a>s with a matching <code class="docutils literal"><span class="pre">emitterAggregateId</span></code>:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">import</span> <span class="nn">com.rbmhtechnology.eventuate._</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">AggregateIdFilter</span><span class="o">(</span><span class="n">aggregateId</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">ReplicationFilter</span> <span class="o">{</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">apply</span><span class="o">(</span><span class="n">event</span><span class="k">:</span> <span class="kt">DurableEvent</span><span class="o">)</span><span class="k">:</span> <span class="kt">Boolean</span> <span class="o">=</span>
    <span class="n">event</span><span class="o">.</span><span class="n">emitterAggregateId</span><span class="o">.</span><span class="n">contains</span><span class="o">(</span><span class="n">aggregateId</span><span class="o">)</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Replication filters can be defined per <code class="docutils literal"><span class="pre">ReplicationConnection</span></code> and event log name. They are transferred to a remote replication endpoint and applied there while reading from a <em>source event log</em> during replication. The following example configures a replication filter for log <code class="docutils literal"><span class="pre">L</span></code> so that only events with a defined <code class="docutils literal"><span class="pre">emitterAggregateId</span></code> of value <code class="docutils literal"><span class="pre">order-17</span></code> are replicated from the remote source log:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">val</span> <span class="n">filter1</span> <span class="k">=</span> <span class="nc">AggregateIdFilter</span><span class="o">(</span><span class="s">&quot;order-17&quot;</span><span class="o">)</span>
<span class="nc">ReplicationConnection</span><span class="o">(</span><span class="s">&quot;127.0.0.1&quot;</span><span class="o">,</span> <span class="mi">2553</span><span class="o">,</span> <span class="nc">Map</span><span class="o">(</span><span class="s">&quot;L&quot;</span> <span class="o">-&gt;</span> <span class="n">filter1</span><span class="o">))</span>
</pre></div>
</div>
<p>Replication filters can also be composed. The following creates a composed filter so that events with a defined <code class="docutils literal"><span class="pre">emitterAggregateId</span></code> of value <code class="docutils literal"><span class="pre">order-17</span></code> or <code class="docutils literal"><span class="pre">order-19</span></code> are replicated:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">val</span> <span class="n">filter2</span> <span class="k">=</span> <span class="n">filter1</span> <span class="n">or</span> <span class="nc">AggregateIdFilter</span><span class="o">(</span><span class="s">&quot;order-19&quot;</span><span class="o">)</span>
<span class="nc">ReplicationConnection</span><span class="o">(</span><span class="s">&quot;127.0.0.1&quot;</span><span class="o">,</span> <span class="mi">2553</span><span class="o">,</span> <span class="nc">Map</span><span class="o">(</span><span class="s">&quot;M&quot;</span> <span class="o">-&gt;</span> <span class="n">filter2</span><span class="o">))</span>
</pre></div>
</div>
<p>For the definition of filter logic based on application-defined events, replication filters should use the <code class="docutils literal"><span class="pre">payload</span></code> field of <code class="docutils literal"><span class="pre">DurableEvent</span></code>.</p>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">Serialization of replication filters can be customized as described in section <a class="reference internal" href="event-sourcing.html#replication-filter-serialization"><span>Custom replication filter serialization</span></a>.</p>
</div>
</div>
<div class="section" id="batch-replication">
<h3>Batch replication<a class="headerlink" href="#batch-replication" title="Permalink to this headline">¶</a></h3>
<p>Events are replicated in batches. The maximum number of events per batch can be configured with</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="n">eventuate</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="o">-</span><span class="n">batch</span><span class="o">-</span><span class="n">size</span> <span class="k">=</span> <span class="mi">512</span>
</pre></div>
</div>
<p>Applications that increase the maximum batch size and/or store rather large events should also increase</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="n">akka</span><span class="o">.</span><span class="n">remote</span><span class="o">.</span><span class="n">netty</span><span class="o">.</span><span class="n">tcp</span><span class="o">.</span><span class="n">maximum</span><span class="o">-</span><span class="n">frame</span><span class="o">-</span><span class="n">size</span> <span class="k">=</span> <span class="mi">128000</span><span class="n">b</span>
</pre></div>
</div>
<p>otherwise, replication may fail.</p>
</div>
<div class="section" id="update-notifications">
<span id="id11"></span><h3>Update notifications<a class="headerlink" href="#update-notifications" title="Permalink to this headline">¶</a></h3>
<p>After having replicated a non-empty event batch, a replication endpoint immediately makes another replication attempt. On the other hand, if the replicated event batch is empty, the next replication attempt is delayed by a duration that can be configured with:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="n">eventuate</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">replication</span><span class="o">.</span><span class="n">retry</span><span class="o">-</span><span class="n">delay</span> <span class="k">=</span> <span class="mi">5</span><span class="n">s</span>
</pre></div>
</div>
<p>Consequently, event replication latency has an upper bound that is determined by this parameter. To minimize event replication latency, replication endpoints by default send event log update notifications to each other. The corresponding configuration parameter is:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="n">eventuate</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">replication</span><span class="o">.</span><span class="n">update</span><span class="o">-</span><span class="n">notifications</span> <span class="k">=</span> <span class="n">on</span>
</pre></div>
</div>
<p>The impact of sending update notifications on average event replication latency, however, decreases with increasing event write load. Applications under high event write load may even experience increased event replication throughput if update notifications are turned <code class="docutils literal"><span class="pre">off</span></code>.</p>
</div>
<div class="section" id="failure-detection">
<h3>Failure detection<a class="headerlink" href="#failure-detection" title="Permalink to this headline">¶</a></h3>
<p>Replication endpoints can notify applications about availability and un-availability of remote event logs. They can become unavailable during a network partition or during a downtime of their hosting application, for example. A local replication endpoint publishes</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">Available(endpointId:</span> <span class="pre">String,</span> <span class="pre">logName:</span> <span class="pre">String)</span></code> messages to the local <code class="docutils literal"><span class="pre">ActorSystem</span></code>s <a class="reference external" href="http://doc.akka.io/docs/akka/2.4.1/scala/event-bus.html#event-stream">event stream</a> if the remote replication endpoint is available, and</li>
<li><code class="docutils literal"><span class="pre">Unavailable(endpointId:</span> <span class="pre">String,</span> <span class="pre">logName:</span> <span class="pre">String)</span></code> messages to the local <code class="docutils literal"><span class="pre">ActorSystem</span></code>s <a class="reference external" href="http://doc.akka.io/docs/akka/2.4.1/scala/event-bus.html#event-stream">event stream</a> if the remote replication endpoint is unavailable</li>
</ul>
<p>Both messages are defined in <a class="reference external" href="../latest/api/index.html#com.rbmhtechnology.eventuate.ReplicationEndpoint$">ReplicationEndpoint</a>. Their <code class="docutils literal"><span class="pre">endpointId</span></code> parameter is the id of the remote replication endpoint, the <code class="docutils literal"><span class="pre">logName</span></code> parameter is the name of an event log that is managed by the remote endpoint. The failure detection limit can be configured with:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="n">eventuate</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">replication</span><span class="o">.</span><span class="n">failure</span><span class="o">-</span><span class="n">detection</span><span class="o">-</span><span class="n">limit</span> <span class="k">=</span> <span class="mi">60</span><span class="n">s</span>
</pre></div>
</div>
<p>It instructs the failure detector to publish an <code class="docutils literal"><span class="pre">Unavailable</span></code> message if there is no heartbeat from the remote replication endpoint within 60 seconds. <code class="docutils literal"><span class="pre">Available</span></code> and <code class="docutils literal"><span class="pre">Unavailable</span></code> messages are published periodically at intervals of <code class="docutils literal"><span class="pre">eventuate.log.replication.failure-detection-limit</span></code>.</p>
</div>
<div class="section" id="disaster-recovery">
<span id="id12"></span><h3>Disaster recovery<a class="headerlink" href="#disaster-recovery" title="Permalink to this headline">¶</a></h3>
<p>Total or partial event loss at a given location is classified as disaster. Event loss can be usually prevented by using a clustered <a class="reference internal" href="#cassandra-storage-backend"><span>Cassandra storage backend</span></a> (at each location) but a catastrophic failure may still lead to event loss. In this case, lost events can be recovered from other locations, optionally starting from an existing storage backup, a procedure called <em>disaster recovery</em>.</p>
<p>If a storage backup exists, events can be partially recovered from that backup so that only events not covered by the backup must be copied from other locations. Recovery of events at a given location is only possible to the extend they have been previously replicated to other locations (or written to the backup). Events that have not been replicated to other locations or for which no storage backup exists cannot be recovered.</p>
<p>Disaster recovery is executed per <code class="docutils literal"><span class="pre">ReplicationEndpoint</span></code> by calling its asynchronous <code class="docutils literal"><span class="pre">recover()</span></code> method. During recovery the endpoint is activated to replicate lost events. Only if recovery successfully completes and all events are recovered the application can start to write new local events, otherwise recovery must be re-tried.</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">import</span> <span class="nn">com.rbmhtechnology.eventuate.ReplicationEndpoint</span>
<span class="k">import</span> <span class="nn">scala.concurrent.Future</span>
<span class="k">import</span> <span class="nn">scala.util._</span>

<span class="k">val</span> <span class="n">endpoint</span><span class="k">:</span> <span class="kt">ReplicationEndpoint</span> <span class="o">=</span> <span class="c1">//...</span>
<span class="k">val</span> <span class="n">recovery</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span> <span class="n">endpoint</span><span class="o">.</span><span class="n">recover</span><span class="o">()</span>

<span class="n">recovery</span> <span class="n">onComplete</span> <span class="o">{</span>
  <span class="k">case</span> <span class="nc">Success</span><span class="o">(</span><span class="k">_</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="c1">// all events recovered, local writes are allowed</span>
  <span class="k">case</span> <span class="nc">Failure</span><span class="o">(</span><span class="n">e</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="c1">// retry recovery ...</span>
<span class="o">}</span>
</pre></div>
</div>
<p>During execution of disaster recovery, directly connected endpoints must be available. These are endpoints for which replication connections have been configured at the endpoint to be recovered. Availability is needed because connected endpoints need to update internal metadata before they can resume event replication with the recovered endpoint.</p>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">In theory a <code class="docutils literal"><span class="pre">ReplicationEndpoint</span></code> could always be activated at the beginning by calling its <code class="docutils literal"><span class="pre">recover()</span></code> method. However, as this requires that all directly connected endpoints must be available, it is not recommended.</p>
</div>
<p>Disaster recovery also deletes invalid snapshots, in case they survived the disaster. Invalid snapshots are those that cover lost events.</p>
<p>A complete reference of <code class="docutils literal"><span class="pre">eventuate.log.recovery.*</span></code> configuration options is given in section <a class="reference internal" href="configuration.html#configuration"><span>Configuration</span></a>. The example application also implements <a class="reference internal" href="../example-application.html#example-disaster-recovery"><span>Disaster recovery</span></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Installing a storage backup is a separate administrative task that is not covered by running <code class="docutils literal"><span class="pre">recover()</span></code>.</p>
</div>
</div>
</div>
<div class="section" id="deleting-events">
<h2>Deleting events<a class="headerlink" href="#deleting-events" title="Permalink to this headline">¶</a></h2>
<p>As outlined in the <a class="reference internal" href="../introduction.html#introduction"><span>Introduction</span></a> an event log is a continuously growing store of immutable facts. Depending on the implementation of the application, not all events are necessarily needed to recover application state after an application or actor restart. For example, if the application saves snapshots, only those events that occurred after the snapshot need to be available. But even without snapshots there can be application-specific boundary conditions that allow an application to recover its state from a certain sequence number on. To keep a store from growing indefinitely in these cases a <code class="docutils literal"><span class="pre">ReplicationEndpoint</span></code> allows the deletion events up to a given sequence number from a local log. Deletion of events actually differentiates between:</p>
<ul class="simple">
<li>Logical deletion of events: Events that are logically deleted are not replayed in case of an actor restart. However they are still available for replication to event logs of connected <code class="docutils literal"><span class="pre">ReplicationEndpoint</span></code>s. All storage backends support logical deletion of events.</li>
<li>Physical deletion of events: Depending on the storage backend logically deleted events are eventually physically deleted. Physical deleted events are of course not available any more for local replay or replication. Physical deletion is currently only supported by the LevelDB backend.</li>
</ul>
<p>While a location can very well decide if it needs certain events from a local event log to recover its state, it may be much less clear if these events might be needed in the future for replication to other locations.
Eventuate can defer physical deletion of events until they are replicated to known <code class="docutils literal"><span class="pre">ReplicationEndpoint</span></code>s. In case a newly added location wants to catch up with the application&#8217;s full event history, it has to connect to a location that actually has the full event history.</p>
<p>Considering this, deletion is invoked through the <code class="docutils literal"><span class="pre">delete</span></code> method of a <code class="docutils literal"><span class="pre">ReplicationEndpoint</span></code>:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="c1">// logically delete all events from log L1 with a sequence number &lt;= 100</span>
<span class="c1">// defer physical deletion until they are replicated to the given endpoints</span>
<span class="k">val</span> <span class="n">logicallyDeleted</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">Long</span><span class="o">]</span> <span class="k">=</span>
  <span class="n">endpoint</span><span class="o">.</span><span class="n">delete</span><span class="o">(</span><span class="s">&quot;L1&quot;</span><span class="o">,</span> <span class="mi">100L</span><span class="o">,</span> <span class="nc">Set</span><span class="o">(</span><span class="s">&quot;remoteEndpointId1&quot;</span><span class="o">,</span> <span class="s">&quot;remoteEndpointId2&quot;</span><span class="o">))</span>

<span class="n">logicallyDeleted</span> <span class="n">onComplete</span> <span class="o">{</span>
  <span class="k">case</span> <span class="nc">Success</span><span class="o">(</span><span class="n">sequenceNr</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="c1">// events up to sequenceNr are logically deleted</span>
  <span class="k">case</span> <span class="nc">Failure</span><span class="o">(</span><span class="n">e</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="c1">// deletion failed</span>
<span class="o">}</span>
</pre></div>
</div>
<p>This method returns the sequence number up to which events are logically deleted. The returned sequence number can differ from the requested one (here <code class="docutils literal"><span class="pre">100L</span></code>), if</p>
<ul class="simple">
<li>the log&#8217;s current sequence number is smaller than the requested number. In this case the current sequence number is returned.</li>
<li>there was a previous successful deletion request with a higher sequence number. In this case that sequence number is returned.</li>
</ul>
<p>Depending on the storage backend, this call also triggers physical deletion of events in a reliable background process that survives event log restarts. To defer physical deletion of not yet replicated events, the third parameter takes a set of <code class="docutils literal"><span class="pre">ReplicationEndpoint</span></code> ids. Events are not physically deleted until they are replicated to these endpoints. If the set is empty, asynchronous deletion is triggered immediately.</p>
<table class="docutils footnote" frame="void" id="id13" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[1]</a></td><td>A location can be a whole data center, a node within a data center or even a process on a single node, for example.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id14" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id9">[2]</a></td><td>Log names must be unique per replication endpoint. Replication connections are only established between logs of the same name.</td></tr>
</tbody>
</table>
</div>
</div>


          </div>
		    
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="event-sourcing.html" class="float-right" title="Event-sourced actors">Next</a>
      
      
        <a href="api-docs.html" title="API docs">Previous</a>
      
    </div>
  
        </div>
	  </div>
    <div class="wrapper-footer">
<footer>
  <div role="contentinfo">
    <p>
        &copy; Copyright 2015 - 2016 Red Bull Media House.  | <a href="http://rbmhtechnology.github.io/imprint" target="_blank">Imprint</a> | <a href="http://rbmhtechnology.github.io/termsconditions" target="_blank">Terms &amp; Conditions</a> | <a href="http://rbmhtechnology.github.io/dataprivacypolicy" target="_blank">Data Privacy Policy</a> 
    </p>
  </div>

</footer>
</div>
      
    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.5-SNAPSHOT',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>